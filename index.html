<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	<h2>Cocktail finder</h2>

	<div style="display: flex;">
		<div style="width: 200px;">
			<input id="ingredient-0" onkeyup="onInputChange(this.value)" type="text" /><br /><br />
			<input id="ingredient-1" onkeyup="onInputChange(this.value)" type="text" /><br /><br />
			<input id="ingredient-2" onkeyup="onInputChange(this.value)" type="text" /><br /><br />
			<input id="ingredient-3" onkeyup="onInputChange(this.value)" type="text" /><br /><br />
			<input id="ingredient-4" onkeyup="onInputChange(this.value)" type="text" /><br /><br />

			<button id="submit">Find</button>
		</div>

		<div id="suggestions" style="width: 200px;"></div>
	</div>

	<div id="result"></div>

	<script type="text/javascript" src="recipes.js"></script>
	<script type="text/javascript">

		var allTokens = recipes.map((recipe) =>
			recipe.ingredients.map((ingredient) =>
				ingredient.split(" ")
			).flat()
		)
		.flat()
		.filter((token) => !token.match(/^[\d\.]/))
		.filter((token) => token !== "oz")
		.map((token) => token.toLowerCase());

		var allTokensSet = new Set(allTokens);
		var ingredientTokens = Array.from(allTokensSet);

		var suggestionsContainer = document.getElementById("suggestions");

		function onInputChange(inputValue) {
			if (inputValue.length > 1) {
				suggestionsContainer.innerHTML = "";
				var matchingTokens = ingredientTokens.filter((token) =>
					token.startsWith(inputValue.toLowerCase())
				).slice(0, 8);;
				matchingTokens.forEach((matchingToken) =>
					suggestionsContainer.innerHTML += matchingToken + "<br />"
				);
			}
		}

		var submitBtn = document.getElementById("submit");

		submitBtn.onclick = function() {
			var matches = recipes;
			for (var i = 0; i < 5; i++) {
				var searchIngredient = document.getElementById("ingredient-" + i).value;
				if (searchIngredient) {
					var lookupRegex = new RegExp("\\b" + searchIngredient + "\\b", "i");
					matches = matches.filter((recipe) =>
						recipe.ingredients.some((ingredient) =>
							lookupRegex.test(ingredient)
						)
					);
				}
			}

			var resultContainer = document.getElementById("result");

			if (matches.length == 0) {
				resultContainer.innerHTML = "<h3>No matches</h3>";
			} else {
				resultContainer.innerHTML = "";
				matches
					.sort(() => Math.random() - 0.5)
					.forEach((recipe) => {
						resultContainer.innerHTML += "<h3>"+recipe.name+"</h3>";
						recipe.ingredients.forEach((ingredient) => {
							resultContainer.innerHTML += ingredient + "<br />";
						});
						resultContainer.innerHTML += "<i>"+recipe.procedure+"</i>" + "<br />";
						resultContainer.innerHTML += "<br />";
					});
			}

		};
	</script>
</body>
</html>